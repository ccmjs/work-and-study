(function(){const component={name:"app_creator",version:[3,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-20.0.0.js",config:{html:{main:{id:"wrapper",inner:[{id:"section-builder",inner:[{id:"wrapper-builder",inner:[{id:"builder"},{id:"preview-button",inner:{id:"button-sticky",inner:{id:"wrapper-button",inner:{tag:"a",id:"button",inner:"preview",style:"color: #fff;"}}}}]},{id:"buttons",class:"text-center",inner:[{tag:"button",id:"button-load",class:"btn",onclick:"%onLoad%",inner:[{tag:"span",class:"fas fa-wrench"},{class:"footer-icon",inner:"LOAD APP"}]},{tag:"button",id:"button-update",class:"btn",disabled:true,onclick:"%onUpdate%",inner:[{tag:"span",class:"fas fa-cloud-upload-alt"},{class:"footer-icon",inner:"UPDATE APP"}]},{tag:"button",id:"button-create",class:"btn",onclick:"%onCreate%",inner:[{tag:"span",class:"far fa-plus-square"},{class:"footer-icon",inner:"NEW APP"}]},{tag:"button",id:"button-delete",disabled:true,class:"btn",onclick:"%onDelete%",inner:[{tag:"span",class:"far fa-trash-alt"},{class:"footer-icon",inner:"DELETE APP"}]}]}]},{id:"section-preview",inner:[{id:"preview"}]}]},read:{id:"read",inner:[{tag:"legend",class:"text-primary",inner:"Load an existing App"},{tag:"p",inner:"Use one of the following ways to load an app:"},{id:"embed",class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"Embed"}},{tag:"input",type:"text",id:"embed_code",class:"form-control","aria-label":"Embed Code"},{class:"input-group-append",inner:{tag:"button",id:"embed_load",class:"btn btn-success",type:"button",inner:"Load App",onclick:"%embed%"}}]},{class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"App ID"}},{tag:"input",type:"text",id:"app_id",class:"form-control","aria-label":"App ID"},{class:"input-group-append",inner:{tag:"button",id:"id_copy",class:"btn btn-success",type:"button",inner:"Load App",onclick:"%app_id%"}}]},{class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"URL"}},{tag:"input",type:"text",id:"app_url",class:"form-control","aria-label":"URL"},{class:"input-group-append",inner:{tag:"button",id:"url_copy",class:"btn btn-success",type:"button",inner:"Load App",onclick:"%url%"}}]}]},usage:{id:"usage",inner:[{tag:"legend",class:"text-primary",inner:["How can you use the App?",{tag:"span",class:"copy-embed-code btn btn-sm btn-warning float-right",inner:"Copy"}]},{tag:"p",class:"text-info",inner:["Add the following ",{tag:"code",inner:"EMBED CODE"}," to your page:"]},{tag:"p",inner:{tag:"code",id:"embed-code"}},{tag:"legend",class:"text-primary",inner:["If you want to change the created App...",{tag:"span",class:"copy-id btn btn-sm btn-warning float-right",inner:"Copy"}]},{tag:"p",class:"alert alert-info",role:"alert",inner:[{tag:"span",class:"glyphicon glyphicon-exclamation-sign"}," Note this ID: ",{tag:"span",class:"text-danger",id:"id"}]}]},deleted:{id:"deleted",inner:{tag:"p",id:"success",class:"lead text-danger",inner:"App was deleted successfully."}},handover:{id:"handover",inner:[{class:"d-flex",inner:[{inner:[{id:"embed",class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"Embed"}},{tag:"input",readonly:true,type:"text",id:"embed_code",class:"form-control bg-white","aria-label":"Embed Code"},{class:"input-group-append",inner:{tag:"button",id:"embed_copy",class:"btn btn-success",type:"button",inner:"Copy"}}]},{class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"App ID"}},{tag:"input",readonly:true,type:"text",id:"app_id",class:"form-control bg-white","aria-label":"App ID"},{class:"input-group-append",inner:{tag:"button",id:"id_copy",class:"btn btn-success",type:"button",inner:"Copy"}}]},{class:"input-group mb-3",inner:[{class:"input-group-prepend",inner:{tag:"span",class:"input-group-text",inner:"URL"}},{tag:"input",readonly:true,type:"text",id:"app_url",class:"form-control bg-white","aria-label":"URL"},{class:"input-group-append",inner:{tag:"button",id:"url_copy",class:"btn btn-success",type:"button",inner:"Copy"}}]}]},{id:"qr_code",class:"pl-2"}]},{class:"text-center",inner:[{tag:"button",type:"button",id:"download",class:"btn btn-primary mr-2",inner:[{tag:"span",class:"fas fa-file-download"}," File"]},{tag:"a",id:"booklet",class:"btn btn-secondary mr-2",inner:[{tag:"span",class:"fas fa-bookmark"}," Booklet"]},{tag:"button",type:"button",id:"ibook",class:"btn btn-info mr-2",inner:[{tag:"span",class:"fas fa-book"}," iBook Widget"]},{tag:"button",type:"button",id:"scorm",class:"btn btn-warning",inner:[{tag:"span",class:"fas fa-archive"}," SCORM"]}]}]}},data:{store:["ccm.store"]},warning:"Are you sure you want to delete this App?",modal:["ccm.component","https://ccmjs.github.io/tkless-components/modal/versions/ccm.modal-2.0.0.js",{css:["ccm.load","https://use.fontawesome.com/releases/v5.6.3/css/all.css"]}],qr_code:["ccm.load","https://ccmjs.github.io/akless-components/libs/qrcode-generator/qrcode.min.js"],helper:["ccm.load",{url:"https://ccmjs.github.io/akless-components/modules/versions/helper-1.0.0.mjs",type:"module"}],app_url:"https://ccmjs.github.io/work-and-study/learningapp-marketplace/app.html",css:["ccm.load","https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css","https://use.fontawesome.com/releases/v5.6.3/css/all.css",{context:"head",url:"https://use.fontawesome.com/releases/v5.6.3/css/all.css"},{context:"head",url:"https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"},"https://tkless.github.io/w2c/v2/resources/js/app_creator/resources/default.css"]},Instance:function(){let $;let builder;this.ready=(async()=>{$=this.ccm.helper;if($.isObject(this.data)&&this.convert)this.data.convert=this.convert.app_to_builder;this.logger&&this.logger.log("ready",$.privatize(this,true))});this.start=(async()=>{const self=this;let dataset=await $.dataset(this.data);this.logger&&this.logger.log("start",$.clone(dataset));let app_id=dataset.key;delete dataset.key;let is_new=!Object.keys(dataset).length;$.setContent(self.element,$.html(self.html.main,{onLoad:loadApp,onCreate:createApp,onUpdate:updateApp,onDelete:deleteApp}));const builder_elem=this.element.querySelector("#builder");const preview_elem=this.element.querySelector("#preview");this.element.querySelector("#button").addEventListener("click",()=>{this.element.querySelector("#wrapper").classList.toggle("active")});const buttons_elem=this.element.querySelector("#buttons");const isLocalStore=!this.data.store.source().name;await renderApp();async function renderApp(){builder=await self.builder.start({root:builder_elem,data:{store:["ccm.store",{app:dataset}],key:"app"},onchange:updatePreview});if(app_id&&!is_new)!isLocalStore&&buttons_elem.querySelectorAll("button").forEach(button=>{if(button.disabled)button.removeAttribute("disabled")});else{buttons_elem.querySelector("#button-update").disabled=true;buttons_elem.querySelector("#button-delete").disabled=true}await updatePreview()}async function createApp(){self.user&&await self.user.login();dataset=builder.getValue();delete dataset.key;if(self.user)dataset._={access:{get:"all",set:"creator",del:"creator"}};app_id=await self.data.store.set(dataset);delete dataset.key;is_new=false;self.logger&&self.logger.log("create",$.clone(dataset));await handoverApp();self.onchange&&self.onchange(self)}async function loadApp(){self.logger&&self.logger.log("read");const content=$.html(self.html.read,{embed:async()=>{const result=self.helper.decomposeEmbedCode(content.querySelector("#embed_code").value.trim(),self.ccm);result&&await load(result.key,result.store.name?await ccm.store(result.store):undefined)},app_id:async()=>await load(content.querySelector("#app_id").value.trim()),url:async()=>{const result=self.helper.decomposeAppURL(content.querySelector("#app_url").value.trim());result&&await load(result.key,result.store.name?await ccm.store(result.store):undefined)}});const dialog=await self.modal.start({modal_title:$.html({tag:"span",id:"failed",class:"text-danger",style:"display: none;",inner:"App-ID not found"}),modal_content:content,footer:[{caption:"Close",style:"danger",onclick:function(){this.close()}}]});async function load(key,store=self.data.store){self.user&&await self.user.login();if(!key)return;dataset=await store.get(key);if(!dataset)return failed();dialog.close();self.logger&&self.logger.log("load",$.clone(dataset));app_id=dataset.key;delete dataset.key;is_new=false;await renderApp();self.onchange&&self.onchange(self,"read");function failed(){const failed_elem=dialog.element.querySelector("#failed");failed_elem.style.display="block";fadeOut(failed_elem)}}}async function updateApp(){if(!app_id||is_new||isLocalStore)return;self.user&&await self.user.login();dataset=builder.getValue();dataset.key=app_id;self.logger&&self.logger.log("update",$.clone(dataset));app_id=await self.data.store.set(dataset);delete dataset.key;await handoverApp();self.onchange&&self.onchange(self)}async function deleteApp(){if(!app_id||is_new||isLocalStore||!confirm(self.warning))return;self.user&&await self.user.login();self.logger&&self.logger.log("delete",$.clone(app_id));await self.data.store.del(app_id);app_id=undefined;is_new=true;dataset={key:$.generateKey()};await renderApp();self.onchange&&self.onchange(self)}async function handoverApp(){!isLocalStore&&buttons_elem.querySelectorAll("button").forEach(button=>{if(button.disabled)button.removeAttribute("disabled")});const content=$.html(self.html.handover);await self.modal.start({modal_title:"Handover of the App",modal_content:content,footer:[{caption:"Close",style:"danger",onclick:function(){this.close()}}]});let store_settings=self.data.store.source();if(isLocalStore){store_settings={};store_settings[app_id]=dataset}const embed_code=self.helper.embedCode?await self.helper.embedCode(self.app.url,store_settings,app_id,undefined,self.ccm):undefined;if(embed_code){content.querySelector("#embed_code").value=embed_code;content.querySelector("#embed_copy").addEventListener("click",()=>copyToClipboard(content.querySelector("#embed_code")))}else $.removeElement(content.querySelector("#embed"));content.querySelector("#app_id").value=app_id;content.querySelector("#id_copy").addEventListener("click",()=>copyToClipboard(content.querySelector("#app_id")));const app_url=self.helper.appURL(self.app.url,store_settings,app_id,self.app_url);content.querySelector("#app_url").value=app_url;content.querySelector("#url_copy").addEventListener("click",()=>copyToClipboard(content.querySelector("#app_url")));if(self.qr_code&&qrcode){let demoQRCode=qrcode(0,"M");demoQRCode.addData(app_url);demoQRCode.make();let qrCodeSVGTag=document.createElement("div");qrCodeSVGTag.innerHTML=demoQRCode.createImgTag();$.setContent(content.querySelector("#qr_code"),qrCodeSVGTag.firstChild)}else $.removeElement(content.querySelector("#qr_code"));if(embed_code&&self.helper.downloadApp)content.querySelector("#download").addEventListener("click",()=>self.helper.downloadApp(embed_code));else $.removeElement(content.querySelector("#download"));if(self.booklet)content.querySelector("#booklet").setAttribute("href",(await self.booklet.instance({app:["ccm.start",self.app.url,self.getValue()],icon:self.icon})).booklet());else $.removeElement(content.querySelector("#booklet"));if(embed_code&&self.helper.iBookWidget)content.querySelector("#ibook").addEventListener("click",()=>self.helper.iBookWidget(embed_code));else $.removeElement(content.querySelector("#ibook"));if(embed_code&&self.helper.scorm)content.querySelector("#scorm").addEventListener("click",()=>self.helper.scorm(embed_code));else $.removeElement(content.querySelector("#scorm"));function copyToClipboard(element){const range=document.createRange();range.selectNode(element);const selection=window.getSelection();selection.removeAllRanges();if(!selection.containsNode(element))selection.addRange(range);document.execCommand("copy")}}function fadeOut(elem){elem.style.opacity=1;(function fade(){if((elem.style.opacity-=.005)>=0)requestAnimationFrame(fade)})()}async function updatePreview(){if(!preview_elem)return;let config=self.getValue();if(self.convert&&self.convert.builder_to_app)config=self.convert.builder_to_app(config);config.root=preview_elem;await self.app.start(config)}});this.getValue=(()=>builder&&builder.getValue&&$.clone(builder.getValue())||null)}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();